<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Saving data to excel | SK</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Saving data to excel" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Learn, Summarize and Blog" />
<meta property="og:description" content="Learn, Summarize and Blog" />
<link rel="canonical" href="https://tikuischan.github.io/fastpages_blog/python/pandas/openpyxl/excel/2021/04/25/Saving-Data-to-Excel.html" />
<meta property="og:url" content="https://tikuischan.github.io/fastpages_blog/python/pandas/openpyxl/excel/2021/04/25/Saving-Data-to-Excel.html" />
<meta property="og:site_name" content="SK" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-04-25T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://tikuischan.github.io/fastpages_blog/python/pandas/openpyxl/excel/2021/04/25/Saving-Data-to-Excel.html","@type":"BlogPosting","headline":"Saving data to excel","dateModified":"2021-04-25T00:00:00-05:00","datePublished":"2021-04-25T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://tikuischan.github.io/fastpages_blog/python/pandas/openpyxl/excel/2021/04/25/Saving-Data-to-Excel.html"},"description":"Learn, Summarize and Blog","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/fastpages_blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://tikuischan.github.io/fastpages_blog/feed.xml" title="SK" /><link rel="shortcut icon" type="image/x-icon" href="/fastpages_blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/fastpages_blog/">SK</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/fastpages_blog/about/">Pervious Logs</a><a class="page-link" href="/fastpages_blog/search/">Search</a><a class="page-link" href="/fastpages_blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Saving data to excel</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-04-25T00:00:00-05:00" itemprop="datePublished">
        Apr 25, 2021
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/fastpages_blog/categories/#Python">Python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/fastpages_blog/categories/#pandas">pandas</a>
        &nbsp;
      
        <a class="category-tags-link" href="/fastpages_blog/categories/#openpyxl">openpyxl</a>
        &nbsp;
      
        <a class="category-tags-link" href="/fastpages_blog/categories/#excel">excel</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/TikuisChan/fastpages_blog/tree/master/_notebooks/2021-04-25-Saving-Data-to-Excel.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/fastpages_blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/TikuisChan/fastpages_blog/master?filepath=_notebooks%2F2021-04-25-Saving-Data-to-Excel.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/fastpages_blog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/TikuisChan/fastpages_blog/blob/master/_notebooks/2021-04-25-Saving-Data-to-Excel.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/fastpages_blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-04-25-Saving-Data-to-Excel.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Perviously (Data Extraction with Python <a href="https://tikuischan.github.io/fastpages_blog/python/dataextraction/pandas/excel/2021/04/04/Data-Extraction-with-Python-Part2.html">part 2</a> and <a href="https://tikuischan.github.io/fastpages_blog/python/dataextraction/openpyxl/excel/2021/04/16/Data-Extraction-with-Python-Part3.html">part 3</a>) we've learnt how to extract data from excel files. Sometimes it is easier for our client (especially when they are not familiar to programming) to check the data if we provide it in excel form. The simpliest way to do it is using <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_excel.html">DataFrame().to_excel</a> function in pandas.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<span class="n">sample_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;col_1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;col_2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="s1">&#39;col_3&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]}</span>
<span class="n">sample_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sample_data</span><span class="p">)</span>
<span class="n">sample_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col_1</th>
      <th>col_2</th>
      <th>col_3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>a</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>b</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>c</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;sample_df.xlsx&#39;</span><span class="p">)</span>

<span class="c1"># we can also put path-like format to save the excel file in specific folder</span>
<span class="n">sample_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;home/target_folder/sample_df.xlsx&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In pratice sometimes things get a bit more complicated. For example there are mulitple tables we need to put in a single excel, or for whatever reason we need to export data in batch, and we want to put all data in a single file, then we need a bit extra work.</p>
<p>For assigning sheet name, we can simply use the parameter sheet_name.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;sample_df.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;sample_df&#39;</span><span class="p">)</span>
<span class="n">sample_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;sample_df.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;sample_df2&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But as we can see in the output file, there is only one sheet named "sample_df2" in the excel file, pandas will create a new file and remove the file with the same name in this case. To tell pandas to write both sheets in the same file, we can use a ExcelWriter object to lock on a single file, and pass to to_excel to write on the same file.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="s1">&#39;sample_df.xlsx&#39;</span><span class="p">)</span>
<span class="n">sample_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;sample_df&#39;</span><span class="p">)</span>
<span class="n">sample_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;sample_df2&#39;</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If the file is already exist, we can add "mode='a'" to avoid losing all the existing data.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="s1">&#39;sample_df.xlsx&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">sample_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;sample_df3&#39;</span><span class="p">)</span>
<span class="n">sample_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;sample_df4&#39;</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>What if we have multiple tables with the same columns and want to concatenate them into same file? There are two ways to do that, the simple way is to combine the tables before write to excel; and the other is to get the maximum row number of the sheet using load_workbook of openpyxl, and feed to "start_row" of "to_excel".</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">load_workbook</span>


<span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;sample_df&#39;</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="s1">&#39;sample_df.xlsx&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">startrow</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># try to open an existing workbook</span>
<span class="n">writer</span><span class="o">.</span><span class="n">book</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="s1">&#39;sample_df.xlsx&#39;</span><span class="p">)</span>

<span class="c1"># get the last row in the existing Excel sheet</span>
<span class="k">if</span> <span class="n">startrow</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">sheetnames</span><span class="p">:</span>
    <span class="c1"># the last row with data is recorded in max_row</span>
    <span class="n">startrow</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="p">[</span><span class="n">table</span><span class="p">]</span><span class="o">.</span><span class="n">max_row</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;the last row in </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">startrow</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">writer</span><span class="o">.</span><span class="n">sheets</span> <span class="o">=</span> <span class="p">{</span><span class="n">ws</span><span class="o">.</span><span class="n">title</span><span class="p">:</span> <span class="n">ws</span> <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">worksheets</span><span class="p">}</span>
<span class="n">sample_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">table</span><span class="p">,</span> <span class="n">startrow</span><span class="o">=</span><span class="n">startrow</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;sample_df.xlsx&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>the last row in sample_df is 4
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>col_1</th>
      <th>col_2</th>
      <th>col_3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>1</td>
      <td>a</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>2</td>
      <td>b</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>3</td>
      <td>c</td>
      <td>6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>col_1</td>
      <td>col_2</td>
      <td>col_3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>1</td>
      <td>a</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.0</td>
      <td>2</td>
      <td>b</td>
      <td>5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2.0</td>
      <td>3</td>
      <td>c</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we have successfully append data after the last row, the only problem is the script above will also include the column name as a row and get rid of the meaningless "Unnamed: 0" column. we can simply use the "header" and "index" parameters to achieve them.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;sample_df&#39;</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="s1">&#39;sample_df.xlsx&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">startrow</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">header</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># try to open an existing workbook</span>
<span class="n">writer</span><span class="o">.</span><span class="n">book</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="s1">&#39;sample_df.xlsx&#39;</span><span class="p">)</span>

<span class="c1"># get the last row in the existing Excel sheet</span>
<span class="k">if</span> <span class="n">startrow</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">sheetnames</span><span class="p">:</span>
    <span class="c1"># the last row with data is recorded in max_row</span>
    <span class="n">startrow</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="p">[</span><span class="n">table</span><span class="p">]</span><span class="o">.</span><span class="n">max_row</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;the last row in </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">startrow</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">startrow</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">header</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># copy existing sheets </span>
<span class="n">writer</span><span class="o">.</span><span class="n">sheets</span> <span class="o">=</span> <span class="p">{</span><span class="n">ws</span><span class="o">.</span><span class="n">title</span><span class="p">:</span> <span class="n">ws</span> <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">worksheets</span><span class="p">}</span>
<span class="n">sample_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">table</span><span class="p">,</span> <span class="n">startrow</span><span class="o">=</span><span class="n">startrow</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;sample_df.xlsx&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>the last row in sample_df is 8
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>col_1</th>
      <th>col_2</th>
      <th>col_3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>1</td>
      <td>a</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>2</td>
      <td>b</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>3</td>
      <td>c</td>
      <td>6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>col_1</td>
      <td>col_2</td>
      <td>col_3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>1</td>
      <td>a</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.0</td>
      <td>2</td>
      <td>b</td>
      <td>5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2.0</td>
      <td>3</td>
      <td>c</td>
      <td>6</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.0</td>
      <td>1</td>
      <td>a</td>
      <td>4</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1.0</td>
      <td>2</td>
      <td>b</td>
      <td>5</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2.0</td>
      <td>3</td>
      <td>c</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sample_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;sample_df2.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;sample_df&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;sample_df2.xlsx&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col_1</th>
      <th>col_2</th>
      <th>col_3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>a</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>b</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>c</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Combine everything together, we can write a simple function like that:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>


<span class="c1"># assume the data are in dict form: {table_name1: DataFrame1, ...}</span>
<span class="k">def</span> <span class="nf">export2excel</span><span class="p">(</span><span class="n">dict_form_data</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="n">load_wb</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">load_wb</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        
    <span class="c1"># for loop in dict loop through the keys</span>
    <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">dict_form_data</span><span class="p">:</span>
        <span class="n">startrow</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">header</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">load_wb</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># try to open an existing workbook</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">book</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

                <span class="c1"># get the last row in the existing Excel sheet</span>
                <span class="k">if</span> <span class="n">startrow</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">sheetnames</span><span class="p">:</span>
                    <span class="n">startrow</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="p">[</span><span class="n">table</span><span class="p">]</span><span class="o">.</span><span class="n">max_row</span>

                <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span> <span class="o">=</span> <span class="p">{</span><span class="n">ws</span><span class="o">.</span><span class="n">title</span><span class="p">:</span> <span class="n">ws</span> <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">worksheets</span><span class="p">}</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="k">pass</span>
        
        <span class="k">if</span> <span class="n">startrow</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">dict_form_data</span><span class="p">[</span><span class="n">table</span><span class="p">]</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">table</span><span class="p">,</span> <span class="n">startrow</span><span class="o">=</span><span class="n">startrow</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;finish exploting to </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The function will create a new file if "file_path" not exist.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sample_sheet_1&#39;</span><span class="p">:</span> <span class="n">sample_df</span><span class="p">,</span> <span class="s1">&#39;sample_sheet_2&#39;</span><span class="p">:</span> <span class="n">sample_df</span><span class="p">,</span> <span class="s1">&#39;sample_sheet_3&#39;</span><span class="p">:</span> <span class="n">sample_df</span><span class="p">}</span>
<span class="n">export2excel</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;final_sample.xlsx&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>finish exploting to final_sample.xlsx
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Run again and now we can see the function actually append data to corresponding sheets.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">export2excel</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;final_sample.xlsx&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>finish exploting to final_sample.xlsx
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For a more complete function, here is a reference from <a href="https://stackoverflow.com/questions/38074678/append-existing-excel-sheet-with-new-dataframe-using-python-pandas">stack overflow</a></p>

</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/fastpages_blog/python/pandas/openpyxl/excel/2021/04/25/Saving-Data-to-Excel.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/fastpages_blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/fastpages_blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/fastpages_blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Learn, Summarize and Blog</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/TikuisChan" target="_blank" title="TikuisChan"><svg class="svg-icon grey"><use xlink:href="/fastpages_blog/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
